-- ==========================================================
-- FASE 1: DDL - CRIAÇÃO DAS TABELAS (INCLUD.IA)
-- Autor: Luiz Eduardo Da Silva Pinto (Global Solution 2025)
-- ==========================================================

-- 1. TABELA DE EMPRESAS
CREATE TABLE T_INC_EMPRESA (
    ID_EMPRESA VARCHAR2(36) PRIMARY KEY, -- UUID vindo do Java
    NOME_OFICIAL VARCHAR2(100) NOT NULL,
    NOME_FANTASIA VARCHAR2(100),
    CNPJ VARCHAR2(18) UNIQUE NOT NULL,
    LOCALIZACAO VARCHAR2(100),
    DESCRICAO CLOB,
    CULTURA CLOB,
    FOTO_CAPA_URL VARCHAR2(255),
    IS_ATIVE NUMBER(1) DEFAULT 1 CHECK (IS_ATIVE IN (0, 1)) -- 1=Ativo, 0=Inativo
);

-- 2. TABELA DE RECRUTADORES (Usuários Corporativos)
CREATE TABLE T_INC_RECRUTADOR (
    ID_RECRUTADOR VARCHAR2(36) PRIMARY KEY,
    NOME VARCHAR2(100) NOT NULL,
    EMAIL VARCHAR2(100) UNIQUE NOT NULL,
    SENHA_HASH VARCHAR2(255) NOT NULL,
    FOTO_PERFIL_URL VARCHAR2(255),
    IS_ATIVE NUMBER(1) DEFAULT 1,
    IS_ONLINE NUMBER(1) DEFAULT 0,
    ID_EMPRESA VARCHAR2(36) NOT NULL,
    CONSTRAINT FK_RECRUTADOR_EMPRESA FOREIGN KEY (ID_EMPRESA) REFERENCES T_INC_EMPRESA (ID_EMPRESA)
);

-- 3. TABELA DE CANDIDATOS (Talentos)
CREATE TABLE T_INC_CANDIDATO (
    ID_CANDIDATO VARCHAR2(36) PRIMARY KEY,
    NOME VARCHAR2(100) NOT NULL,
    CPF VARCHAR2(14) UNIQUE NOT NULL,
    EMAIL VARCHAR2(100) UNIQUE NOT NULL,
    SENHA_HASH VARCHAR2(255) NOT NULL,
    -- Endereço (Embedded no Java, colunas aqui)
    CEP VARCHAR2(10),
    LOGRADOURO VARCHAR2(150),
    NUMERO VARCHAR2(20),
    BAIRRO VARCHAR2(100),
    CIDADE VARCHAR2(100),
    ESTADO VARCHAR2(50),
    RAIO_BUSCA_KM NUMBER(5),
    -- Perfil Profissional
    RESUMO_PERFIL CLOB,
    RESUMO_INCLUSIVO_IA CLOB, -- Gerado pela IA
    FOTO_PERFIL_URL VARCHAR2(255),
    IS_ATIVE NUMBER(1) DEFAULT 1,
    IS_ONLINE NUMBER(1) DEFAULT 0
);

-- 4. TABELA DE SKILLS (Competências)
CREATE TABLE T_INC_SKILL (
    ID_SKILL VARCHAR2(36) PRIMARY KEY,
    NOME VARCHAR2(100) UNIQUE NOT NULL,
    TIPO_SKILL VARCHAR2(20) CHECK (
        TIPO_SKILL IN ('HARD_SKILL', 'SOFT_SKILL')
    )
);

-- Tabela Associativa: Candidato x Skills
CREATE TABLE T_INC_CANDIDATO_SKILL (
    ID_CANDIDATO VARCHAR2(36) NOT NULL,
    ID_SKILL VARCHAR2(36) NOT NULL,
    PRIMARY KEY (ID_CANDIDATO, ID_SKILL),
    CONSTRAINT FK_CS_CANDIDATO FOREIGN KEY (ID_CANDIDATO) REFERENCES T_INC_CANDIDATO (ID_CANDIDATO),
    CONSTRAINT FK_CS_SKILL FOREIGN KEY (ID_SKILL) REFERENCES T_INC_SKILL (ID_SKILL)
);

-- 5. TABELA DE VAGAS (Jobs)
CREATE TABLE T_INC_VAGA (
    ID_VAGA VARCHAR2(36) PRIMARY KEY,
    ID_RECRUTADOR VARCHAR2(36) NOT NULL,
    ID_EMPRESA VARCHAR2(36) NOT NULL,
    TITULO VARCHAR2(100) NOT NULL,
    DESCRICAO_ORIGINAL CLOB NOT NULL,
    DESCRICAO_INCLUSIVA CLOB, -- Gerado pela IA
    LOCALIZACAO VARCHAR2(100),
    TIPO_VAGA VARCHAR2(50), -- Ex: TEMPO_INTEGRAL, ESTAGIO
    MODELO_TRABALHO VARCHAR2(20) CHECK (
        MODELO_TRABALHO IN (
            'PRESENCIAL',
            'HIBRIDO',
            'REMOTO'
        )
    ),
    SALARIO_MIN NUMBER(10, 2),
    SALARIO_MAX NUMBER(10, 2),
    BENEFICIOS CLOB,
    EXPERIENCIA_REQ CLOB,
    IS_ATIVA NUMBER(1) DEFAULT 1,
    CREATED_AT TIMESTAMP DEFAULT SYSTIMESTAMP,
    CONSTRAINT FK_VAGA_RECRUTADOR FOREIGN KEY (ID_RECRUTADOR) REFERENCES T_INC_RECRUTADOR (ID_RECRUTADOR),
    CONSTRAINT FK_VAGA_EMPRESA FOREIGN KEY (ID_EMPRESA) REFERENCES T_INC_EMPRESA (ID_EMPRESA)
);

-- Tabela Associativa: Vaga x Skills Desejadas
CREATE TABLE T_INC_VAGA_SKILL (
    ID_VAGA VARCHAR2(36) NOT NULL,
    ID_SKILL VARCHAR2(36) NOT NULL,
    PRIMARY KEY (ID_VAGA, ID_SKILL),
    CONSTRAINT FK_VS_VAGA FOREIGN KEY (ID_VAGA) REFERENCES T_INC_VAGA (ID_VAGA),
    CONSTRAINT FK_VS_SKILL FOREIGN KEY (ID_SKILL) REFERENCES T_INC_SKILL (ID_SKILL)
);

-- 6. TABELA DE MATCHES (O Coração do App)
CREATE TABLE T_INC_MATCH (
    ID_MATCH VARCHAR2(36) PRIMARY KEY,
    ID_CANDIDATO VARCHAR2(36) NOT NULL,
    ID_VAGA VARCHAR2(36) NOT NULL,
    MATCH_SCORE NUMBER(5, 2), -- Ex: 85.50
    STATUS VARCHAR2(30) CHECK (
        STATUS IN (
            'PENDENTE',
            'MATCHED',
            'REJEITADO_CANDIDATO',
            'REJEITADO_RECRUTADOR'
        )
    ),
    LIKED_BY_CANDIDATE NUMBER(1) DEFAULT 0,
    LIKED_BY_RECRUITER NUMBER(1) DEFAULT 0,
    CONSTRAINT FK_MATCH_CANDIDATO FOREIGN KEY (ID_CANDIDATO) REFERENCES T_INC_CANDIDATO (ID_CANDIDATO),
    CONSTRAINT FK_MATCH_VAGA FOREIGN KEY (ID_VAGA) REFERENCES T_INC_VAGA (ID_VAGA),
    CONSTRAINT UNQ_MATCH_PAIR UNIQUE (ID_CANDIDATO, ID_VAGA)
);

-- 7. TABELA DE AUDITORIA (Obrigatória na Fase 1)
CREATE TABLE T_INC_LOG_AUDITORIA (
    ID_LOG NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NOME_TABELA VARCHAR2(50),
    OPERACAO VARCHAR2(20), -- INSERT, UPDATE, DELETE
    USUARIO_DB VARCHAR2(50),
    DATA_HORA TIMESTAMP DEFAULT SYSTIMESTAMP,
    DADOS_ANTIGOS CLOB
);